2022년 4월 부터 샵팬픽에서, 여러 프로젝트를 진행하였다. 오늘은 진행했던 프로젝트에 대해 소개하려 한다.

처음 회사에 들어갔을 때, 가장 처음으로 했던 일은 메일 템플릿을 제작하는 일이었다. html 템플릿이었는데, mailgun에 올려놓고 특정 변수만 변경되는 템플릿이었다. 기존 scss에 적응해 있었던 터라, css 파일을 따로 분리하는 것에 익숙하였다. html 내부에 inline으로 css를 작성하는 것에 거부감이 있었지만, mailgun에서 css 파일을 따로 지원하지 않아 inline css로 템플릿을 제작하였다. 이후 천천히 프로젝트에 적응하면서 홈페이지 css에서 발생하는 이슈들을 (배너 사이즈 문제라던지, 간격이 맞지 않는 다던지 하는) 처리해 나갔다.

비록 퍼블리셔로 입사했지만 마음 속에는 개발자로서의 야망이 있었다. 몇 년을 디자인을 했지만 디자인에 크게 소질이 없(다고 생각했)어서 나 자신은 퍼블리셔로서 비전이 크게 없다고 판단했다. 또한 개발 업무에 대한 열망이 있어 언제든 기회만 오면 역량을 펼쳐 나가겠다는 확고한 의지가 있었다.

# 모든 일의 시작, 리워크

호시탐탐 기회를 노리던 중, 샵팬픽에서 처음으로 제대로 진행했던 프로젝트는 리워크였다.
React로 작업된 기존 프로젝트의 복잡도가 증가하여 신규 기능을 추가하기에 부적합하다는 개발 팀장님의  판단이 있었다. 여러 회의를 거듭하여 Next.js가 프레임워크로 선정되었다. 기존 프로젝트와 Next.js 간 러닝 커브가 적다는 판단이었다.

Next.js로 결정되고 난 후 여러 스펙을 결정하기 위한 회의가 진행되었다. 아토믹 디자인 시스템을 적용해보자는 목소리가 나왔다. 아토믹 디자인 시스템이란, 컴포넌트를 작은 단위부터 제작하여 컴포넌트 재사용성을 높이고, 통일성을 줄 수 있겠다고 판단되었다. 해당 시스템을 구현하기 위해 여러 CSS 라이브러리들도 검토되었다. CSS classname 충돌 등의 문제를 막기 위해 tailwind.css, styled component를 사용하게 되었다. (추후 복잡성을 줄이기 위해 tailwind.css로 통합되었다.) 여러 스타일의 컴포넌트 버전 관리를 위해 storybook도 도입하게 되었다.

프로젝트 진행은 애자일/스프린트 방식으로 진행되었다. 주 1회 개발팀 회의가 진행되었고, 각 회의마다 얼마나 업무가 진행되었고 필요한 지원사항 및 향후 개발 방향에 대해 논의되었다. 각 사람마다 주어진 업무량을 완료하면 남은 업무 중에 필요한 업무들을 추가 지원하는 방향으로 업무를 치고 나갔다. 드디어 개발자로서 첫 걸음을 내딛을 기회가 왔구나 생각했던 나는 업무를 빠르게 치고나갔다.

아토믹 디자인 시스템의 기틀이 되는 Atom 단계의 컴포넌트들부터 차근차근 프로젝트가 쌓아져 나갔다. 처음에 작은 단위의 컴포넌트부터 만들어져서, 페이지 전체 프리뷰를 공유하기가 어려웠다. Storybook이 그 때 역할을 해줬다. 작은 컴포넌트들이 모여 큰 컴포넌트를 만드는 과정들을 공유하고 외부 팀들도 해당 내용들을 공유 받을 수 있었다.

## 버전 충돌 이슈

Next.js와 Storybook사이에 호환성 문제가 발생했다. next.js에서는 작동하는 컴포넌트가 storybook에서는 작동하지 않는 이슈, storybook 내에서 오류 메세지가 계속 발생하는 등의 문제였다.

두 프로젝트가 서로 지원하는 React 버전이 달라 호환성을 위해 여러 작업들을 진행하였으나, 지속적으로 문제가 발생하였다. 결국 UI 관리를 위해 진행했던 스토리북을 폐기하고 배포 이전에 개발 서버를 운영하여 UI 테스트를 진행하기로 결정되었다.

## 개발팀과 외부 팀의 소통 문제

개발팀에서 진행하는 프로젝트를 외부 팀에서 알기 어려워 소통에 문제가 발생하였다. 진행 완료된 프로젝트가 회사의 기획 의도와 맞지 않게 진행되어 다시 제작해야 하는 일이 발생하는 등의 문제였다. 기존에는 해당 내용의 소통을 위해 figma로 전체 컴포넌트에 대한 초안을 작성하고 난 후 프로젝트를 진행하였지만, 모든 사람의 요구를 충족할 수 있는 디자인은 요원하였다. 소통에 걸리는 시간으로 인해 프로젝트가 딜레이되는 문제도 있었다. 하여, 프로젝트 관련 소통은 개발팀 내에서 진행하고 팀 외부 소통은 개발팀장님이 담당해주셨다.

이후 사전에 제작 중인 프로젝트를 임시 서버에서 실시간으로 공유하여 볼 수 있도록 ngrok로 임시 배포하여 실시간 소통하여 문제를 해결하였다.

## 처음 겪어보는 데이터 바인딩

UI 제작이 어느 정도 마무리 되고 난 후, 기존 DB의 데이터들을 새로운 홈페이지에 바인딩 하기 위한 업무가 시작되었다. 퍼블리셔로 들어왔던 나에게 데이터 바인딩을 맡겨도 될지에 대해 팀 내부에서 논의가 있었지만, 해보니 크게 어렵지 않았다. 물론 완벽하진 않아서 나중에 다시 손을 봐야 하는 경우가 태반이었지만 프로젝트 일정이 얼마 남지 않아 부족한 손을 보탰다.

어느 정도 기존 뷰와 동일한 뷰가 만들어지고 난 뒤, 배포 테스트가 진행되었다. 로그인 기능, 상품 찜하기 기능, 검색 기능 등 여러 기능에서 버그가 발견되었다. 해당 버그를 잡기 위해 리팩토링이 진행되었다. (테스팅 툴을 적용했다면 더 효율적으로 업무가 진행되었을 것이라고 생각된다.) 이후 홈페이지 데이터 바인딩이 어느 정도 마무리 되고 백 오피스 작업이 진행되었다.

백 오피스 작업도 순탄하진 않았다. 홈페이지에 비해 백엔드 기능이 더 많이 요구되었다. 기존에 추정했던 프로젝트 기한이 연기되기도 하고, 부족한 손을 더하기 위해 백엔드 로직 제작에 동참하게 되었다. prisma로 쿼리를 작성하는 작업은 크게 어렵진 않았다. 단순 CRUD 작업을 반복해야 하는 경우가 많았다.

단, 팀장님은 이러한 작업을 시키신 이유가 있으신 것 같았다. 백 오피스 작업이 어느 정도 마무리 되고 난 후 개발팀 운영에 개편이 있었다. 개발팀 각 인원 마다 프로젝트 담당자로 업무를 진행하는 것으로 변경되었다. 이제 모든 인원이 뷰부터 백엔드 로직까지 크게 무리 없이 제작 가능할 것이라는 판단에서였다. 필요한 점이 있으면 서로 요청하면서 업무를 진행하는 것으로 이야기 되었다.

# 엑셀 다운로드 기능

처음으로 맡았던 프로젝트는 백 오피스 엑셀 다운로드/업로드 기능 제작이었다. DB에 저장된 엑셀 파일을 다운로드 받고, 템플릿으로 만들어진 엑셀 파일로 DB를 업데이트 하는 내용이었다. 

데이터 컬럼명과 엑셀 컬럼명이 달라서 해당 내용을 대조하고, 반영하도록 각 함수들을 구현하고 데이터 중 json으로 중첩되어 있는 데이터들은 재귀 함수로 처리하였다. 잘 작동하는지 여러 번 테스트하고 데이터를 변경해가며 테스트 해보았다. (이 때라도 테스트 도구를 추가했어야 했다.)

그런데 문제가 발생했다. 엑셀 파일의 데이터 핸들링은 잘 되지만, 파일을 암호화하는 방법을 찾기가 어려웠다. next.js의 서버리스 환경에서도 작동할 수 있도록 외부 환경에 영향을 받지 않는 암호화 모듈을 찾는게 관건이었다. 수 많은 시도 끝에 한 모듈이 서버리스 환경에서 zip파일로 압축함과 동시에 엑셀 파일을 암호화 해 주었다.

이전에 진행하던 간단한 CRUD 시스템은 1-2주 내에 간단하게 구현이 가능했으나, 처음으로 복잡한 백엔드 로직과 암호화 등의 기능을 개발하는데는 1개월 반 정도 소요되었고, 테스트 결과 이상 없음을 확인하고 서버에 배포하였다.

# 홈페이지 메인 페이지 변경

이 후 좀 더 복잡한 로직에 자신이 생겼다. 마침 홈페이지 상품에 유입량을 늘리기 위해 메인 페이지를 리워크 해 달라는 요구사항이 발생했다. 데이터 베이스 구조, 정규화 등을 공부하고 있던 나는 홈페이지의 콘텐츠 리스트 쿼리 옵션을 DB에 저장하고 콘텐츠의 기본 옵션 테이블과 특별 옵션 테이블을 분리하여 저장하는 방법에 대해서 고민했다. 

예를 들면, 순서 / 콘텐츠 제목 / 콘텐츠 타입 등의 콘텐츠가 기본으로 가지고 있는 속성은 기본 옵션 테이블에 저장하고, 콘텐츠 타입에 따라 달라지는 옵션들은 특별 옵션 테이블에 저장하는 방안이었다. 전체 구조에 대해 컨펌을 받고, 타입 저장 방식을 enum 타입이 아니라 table 단위로 저장하는 방식으로 수정하여 서로 참조할 수 있도록 변경한 후 해당 프로젝트를 시작하였다.

처음 제작한 건 콘텐츠 리스트 컴포넌트였다. 각 콘텐츠 아이템들이 들어가면 넓이에 맞춰 해당 아이템들을 수용할 수 있도록 display: grid로 감싸는 컴포넌트였다. 해당 컴포넌트 내에 규격에 맞는 리스트 아이템 컴포넌트들을 넣으면 반응형으로 작동하도록 설계되었다.

그리고 해당 리스트들을 불러올 수 있도록 데이터 조회 로직과, 데이터 조회 로직에 들어갈 변수들을 불러오는 로직까지 구현하였다. 처음에는 next.js에서 제공하는 getServerSideProps를 활용해서 변수들을 가져왔지만, 사용량이 늘어나 훅으로 처리하게 변경하였다.

처음에는 메인 페이지 콘텐츠 리스트에 상품/크리에이터 두 가지 콘텐츠만 예정되어 있었다. 이후 추가로 게시물 타입, 배너 타입, 배너-상품 혼합 타입 등이 추가되었다. 이 때 정규화의 중요성을 깨달았다. 여러 타입이 추가되어도 특별 옵션 테이블을 하나 추가하고 콘텐츠 타입에 컬럼을 하나 늘려주는 것으로 해결되었다. 각 타입에 맞는 콘텐츠 관리 기능을 백 오피스에 추가하는 것도 잊지 않았다.

# 이 후, 퇴사하기 까지

이 후 맡았던 프로젝트는 커뮤니티 프로젝트였다. 샵팬픽에 함께 하는 크리에이터들과 팬들이 함께 사용할 수 있는 커뮤니티가 기획되어 해당 프로젝트를 진행하였다. 해당 프로젝트는 퇴사하기 1주일 전에 마무리(?) 되었는데, 배포하는데는 시간이 걸리는 것 같다. (트위치 사태가 큰 영향을 준 것으로 보인다.)

해당 프로젝트를 진행하면서 무한 스크롤에 useSWRInfinite를 사용해보았는데, 기존 홈페이지에서 구현했던 무한 스크롤에 비해 깔끔하게 페이지네이션이 가능했다. 페이지를 넘길 때 마다 SWR에서 페이지별 캐싱 기능을 제공하여 비용도 절감되고 로딩 속도도 빨랐다. (useSWRInfinite의 fetcher 함수에 대한 상세한 문서를 찾기가 어려워 조금 노가다가 필요했다.) 여태 맡았던 프로젝트 중에 가장 마음에 드는 프로젝트였다. (언제 출시될까? 출시가 안 된다는 말도.. 총총)

퇴사를 하게 된 이유는, 회사의 사정과 개인의 니즈로 인한 퇴사였다. (자세한 내용은 이 글을 회사에서 읽으면 곤란할 수 있으므로 생략하려고 한다.) 1년 9개월 동안 함께 한 샵팬픽에게, 지금까지 즐겁기도 하고 성장할 수 있는 회사 생활을 안겨준 것에 감사의 인사 말씀을 드린다. 내가 만났던 좋은 사람들에게, 또 좋은 날 좋은 때 뵐 날이 있었으면 한다.